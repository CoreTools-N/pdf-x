<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF-X | 2026 Full Edition</title>
    
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    <style>
        :root { --red: #e5322d; --dark: #2c2c34; --bg: #f3f0ec; --blue: #007bff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        .header { background: white; padding: 15px 5%; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { color: var(--red); font-size: 1.8rem; font-weight: 800; text-decoration: none; }
        
        .main-layout { display: flex; justify-content: center; padding: 20px; gap: 20px; }
        .ad-sidebar { width: 160px; height: 600px; background: #ddd; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 12px; color: #666; border: 1px solid #ccc; flex-shrink: 0; }
        
        .ws-container { max-width: 1100px; margin: 20px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; position: relative; flex: 1; }
        
        .tool-header-wrapper { display: flex; justify-content: flex-start; margin-bottom: 15px; }
        .tool-title-styled { color: var(--red); font-weight: 800; font-size: 1.5rem; border-left: 5px solid var(--red); padding-left: 15px; }

        .help-guide { background: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; font-size: 14px; color: #856404; line-height: 1.6; }

        .uploader-box { border: 2px dashed #bbb; padding: 60px; border-radius: 10px; cursor: pointer; background: #fafafa; transition: 0.3s; margin-bottom: 20px; }
        .uploader-box:hover, .uploader-box.dragover { border-color: var(--red); background: #fff1f0; }

        #global-view { display: none; margin-bottom: 30px; }
        .global-card { background: white; border: 2px solid #eee; padding: 20px; border-radius: 12px; width: 220px; position: relative; display: inline-block; }
        .master-del-btn { position: absolute; top: -15px; right: -15px; background: var(--red); color: white; border: 3px solid white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; }

        #preview-area { display: flex; overflow-x: auto; gap: 0; padding: 50px 20px; align-items: center; background: #eee; border-radius: 10px; margin-top: 30px; }
        .preview-item { background: #fff; border: 1px solid #ccc; padding: 5px; border-radius: 4px; flex: 0 0 auto; box-shadow: 0 4px 8px rgba(0,0,0,0.15); width: 140px; height: 200px; display: flex; flex-direction: column; justify-content: center; z-index: 1; margin: 0 5px; }
        .preview-item img { width: 100%; height: 180px; object-fit: contain; pointer-events: none; }

        .split-divider { width: 40px; height: 180px; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; flex: 0 0 auto; z-index: 10; }
        .split-divider::after { content: ''; width: 4px; height: 100%; background: #ddd; transition: 0.2s; border: 1px dashed #999; }
        .split-divider:hover::after, .split-divider.active::after { background: var(--red); width: 6px; border: none; }
        .split-divider:hover::before, .split-divider.active::before { content: '✂️'; position: absolute; top: -25px; font-size: 20px; }

        /* RESULT AREA CARDS */
        #result-area { display: none; margin-top: 30px; border-top: 2px solid #eee; padding-top: 30px; }
        .download-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .download-card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .download-card img { width: 100%; height: 150px; object-fit: contain; background: #f9f9f9; border-radius: 5px; margin-bottom: 10px; }
        .btn-download { background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }

        .btn-action { background: var(--red); color: white; border: none; padding: 18px 50px; font-size: 1.2rem; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: 30px; display: none; }
        .ad-bottom { width: 100%; max-width: 728px; height: 90px; background: #eee; border: 1px solid #ccc; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 12px; }

        .loading-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); flex-direction: column; align-items: center; justify-content: center; border-radius: 15px; z-index: 1000; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--red); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <a href="#" class="logo" onclick="location.reload()">PDF<span>-X</span></a>
        <span>v2.0 Full Edition</span>
    </div>

    <div class="main-layout">
        <div class="ad-sidebar">Sponsored Ad</div>
        <div class="ws-container">
            <div id="status-overlay" class="loading-screen">
                <div class="spinner"></div>
                <h3 id="status-text">Processing...</h3>
            </div>

            <div class="tool-header-wrapper">
                <div class="tool-title-styled">Split PDF</div>
            </div>

            <div id="help-box" class="help-guide">
                <strong>Guide:</strong><br>
                <span>• Click gray lines in row to cut.</span><br>
                <span>• You can make multiple split to files.</span>
            </div>

            <div id="drop-zone" class="uploader-box" onclick="document.getElementById('file-input').click()">
                <h3>Click or Drag PDF Files Here</h3>
                <input type="file" id="file-input" accept="application/pdf" hidden onchange="handleFiles(this.files)">
            </div>

            <div id="global-view">
                <div class="global-card">
                    <button class="master-del-btn" onclick="location.reload()">X</button>
                    <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" width="50"><br>
                    <small id="global-filename"></small>
                </div>
            </div>

            <div id="preview-area"></div>
            
            <button id="action-btn" class="btn-action" onclick="processTask()">PROCESS & DOWNLOAD</button>

            <div id="result-area">
                <h2 style="color: #28a745;">Success! Your files are ready.</h2>
                <div id="download-grid" class="download-grid"></div>
                <button class="btn-action" onclick="location.reload()" style="background:#666; display:inline-block;">Split Another File</button>
            </div>
        </div>
        <div class="ad-sidebar">Sponsored Ad</div>
    </div>

    <div class="ad-bottom">Leaderboard Advertisement (728x90)</div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        
        let uploadedFiles = [], cutPoints = new Set(), pageThumbnails = [];
        const previewArea = document.getElementById('preview-area');
        const actionBtn = document.getElementById('action-btn');
        const dropZone = document.getElementById('drop-zone');
        const statusOverlay = document.getElementById('status-overlay');
        const statusText = document.getElementById('status-text');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
            dropZone.addEventListener(e, (ev) => { ev.preventDefault(); ev.stopPropagation(); });
        });
        ['dragenter', 'dragover'].forEach(e => { dropZone.addEventListener(e, () => dropZone.classList.add('dragover')); });
        ['dragleave', 'drop'].forEach(e => { dropZone.addEventListener(e, () => dropZone.classList.remove('dragover')); });
        dropZone.addEventListener('drop', (e) => { handleFiles(e.dataTransfer.files); });

        async function handleFiles(files) {
            if(files.length === 0 || files[0].type !== 'application/pdf') return;
            statusOverlay.style.display = 'flex';
            statusText.innerText = "Analyzing Files...";
            const file = files[0];
            document.getElementById('global-view').style.display = 'block';
            document.getElementById('global-filename').innerText = file.name;
            dropZone.style.display = 'none';
            actionBtn.style.display = 'inline-block';
            uploadedFiles = [file];
            await renderVisualPages(file);
            statusOverlay.style.display = 'none';
        }

        async function renderVisualPages(file) {
            const pdf = await pdfjsLib.getDocument({data: await file.arrayBuffer()}).promise;
            previewArea.innerHTML = ""; pageThumbnails = [];
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({scale: 0.3});
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height; canvas.width = viewport.width;
                await page.render({canvasContext: context, viewport: viewport}).promise;
                const imgData = canvas.toDataURL();
                pageThumbnails.push(imgData);
                
                const div = document.createElement('div');
                div.className = 'preview-item';
                div.innerHTML = `<img src="${imgData}"><small>Page ${i}</small>`;
                previewArea.appendChild(div);

                if (i < pdf.numPages) {
                    const divi = document.createElement('div');
                    divi.className = 'split-divider';
                    divi.onclick = function() {
                        this.classList.toggle('active');
                        if (cutPoints.has(i)) cutPoints.delete(i); else cutPoints.add(i);
                    };
                    previewArea.appendChild(divi);
                }
            }
        }

        async function processTask() {
            statusOverlay.style.display = 'flex';
            statusText.innerText = "Splitting PDF...";
            const grid = document.getElementById('download-grid');
            grid.innerHTML = "";
            const doc = await PDFLib.PDFDocument.load(await uploadedFiles[0].arrayBuffer());
            const sortedCuts = Array.from(cutPoints).sort((a,b) => a-b);
            let start = 0;
            const points = [...sortedCuts, doc.getPageCount()];
            
            for (let i=0; i < points.length; i++) {
                const end = points[i];
                const newDoc = await PDFLib.PDFDocument.create();
                const copied = await newDoc.copyPages(doc, Array.from({length: end-start}, (_,k) => start+k));
                copied.forEach(p => newDoc.addPage(p));
                const url = URL.createObjectURL(new Blob([await newDoc.save()], {type: "application/pdf"}));
                
                const card = document.createElement('div');
                card.className = 'download-card';
                card.innerHTML = `
                    <img src="${pageThumbnails[start]}">
                    <strong>Part ${i+1}</strong><br>
                    <small>${end-start} Pages</small><br>
                    <button class="btn-download" onclick="triggerDownload('${url}', 'part_${i+1}.pdf')">Download</button>
                `;
                grid.appendChild(card);
                start = end;
            }
            statusOverlay.style.display = 'none';
            previewArea.style.display = 'none'; actionBtn.style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('help-box').style.display = 'none';
        }

        async function triggerDownload(url, name) {
            statusOverlay.style.display = 'flex';
            statusText.innerText = "Almost ready! Your file is being prepared...";
            await new Promise(r => setTimeout(r, 1500));
            const link = document.createElement('a');
            link.href = url; link.download = name; link.click();
            statusOverlay.style.display = 'none';
        }
    </script>
</body>
</html>