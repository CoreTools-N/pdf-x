<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compress PDF | PDF-X 2026</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root { --red: #e5322d; --dark: #333; --bg: #f3f0ec; --green: #28a745; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; }
        
        .header { background: white; padding: 15px 5%; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { color: var(--red); font-size: 1.8rem; font-weight: 800; text-decoration: none; }

        .main-layout { display: flex; justify-content: center; padding: 20px; gap: 20px; }
        .ad-sidebar { width: 160px; height: 600px; background: #ddd; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 12px; color: #666; border: 1px solid #ccc; flex-shrink: 0; position: sticky; top: 80px; }
        
        .ws-container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); flex: 1; min-height: 80vh; text-align: center; }
        .tool-title { font-size: 2rem; font-weight: 800; margin-bottom: 10px; color: #222; }

        /* iLovePDF LEVEL CARDS */
        .compression-levels { display: none; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0; }
        .level-card { background: white; border: 2px solid #eee; padding: 25px 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; position: relative; }
        .level-card:hover { border-color: var(--red); background: #fdf2f2; }
        .level-card.active { border-color: var(--red); background: #fdf2f2; box-shadow: 0 4px 12px rgba(229,50,45,0.15); }
        .level-card h4 { margin: 0 0 10px 0; font-size: 16px; color: #333; }
        .level-card p { font-size: 12px; color: #777; margin: 0; line-height: 1.4; }

        .uploader-box { border: 2px dashed #bbb; padding: 80px 20px; border-radius: 8px; cursor: pointer; background: #fafafa; }
        .uploader-box:hover { border-color: var(--red); background: #fff1f0; }

        #preview-area { display: none; margin-top: 30px; justify-content: center; }
        .a4-preview { background: white; width: 210px; height: 297px; border: 1px solid #ddd; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .a4-preview img { width: 100%; height: 100%; object-fit: contain; }

        .btn-action { background: var(--red); color: white; border: none; padding: 20px 0; font-size: 1.4rem; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: 30px; display: none; width: 100%; }

        #result-area { display: none; margin-top: 40px; }
        .download-box { background: var(--light); padding: 30px; border-radius: 12px; border: 1px solid #ddd; display: inline-block; width: 350px; }
        .btn-download { background: var(--green); color: white; border: none; padding: 15px; border-radius: 6px; width: 100%; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-top: 15px; }

        .loading-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--red); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <a href="#" class="logo">PDF<span>-X</span></a>
        <span>Professional Tools 2026</span>
    </div>

    <div class="main-layout">
        <div class="ad-sidebar">Advertisement</div>

        <div class="ws-container">
            <div id="status-overlay" class="loading-screen">
                <div class="spinner"></div>
                <h3 id="status-text">Compressing...</h3>
                <p id="sub-status" style="color:#888;">Optimizing file layers</p>
            </div>

            <div class="tool-title">Compress PDF</div>
            <p style="color:#666; margin-bottom: 30px;">Reduce file size while optimizing for maximal quality.</p>

            <div id="drop-zone" class="uploader-box" onclick="document.getElementById('file-input').click()">
                <img src="https://cdn-icons-png.flaticon.com/512/1091/1091585.png" width="50" style="margin-bottom:15px; opacity:0.5;">
                <h3>Select PDF file</h3>
                <p>or drag and drop PDF here</p>
                <input type="file" id="file-input" accept="application/pdf" hidden onchange="initTools(this.files[0])">
            </div>

            <div id="levels" class="compression-levels">
                <div class="level-card" onclick="setLevel(0.08, 0.7, this)">
                    <h4>Extreme Compression</h4>
                    <p>Less quality, high compression.</p>
                </div>
                <div class="level-card active" onclick="setLevel(0.4, 1.0, this)">
                    <h4>Recommended</h4>
                    <p>Good quality, good compression.</p>
                </div>
                <div class="level-card" onclick="setLevel(0.8, 1.3, this)">
                    <h4>Less Compression</h4>
                    <p>High quality, less compression.</p>
                </div>
            </div>

            <div id="preview-area">
                <div class="a4-preview"><img id="thumb-img" src=""></div>
            </div>
            
            <button id="action-btn" class="btn-action" onclick="runCompressionEngine()">COMPRESS PDF</button>

            <div id="result-area">
                <div class="download-box">
                    <h3 style="margin-top:0;">PDF Compressed!</h3>
                    <p id="size-report" style="color:var(--green); font-weight:bold;"></p>
                    <button class="btn-download" onclick="doDownload()">Download PDF</button>
                </div>
            </div>
        </div>

        <div class="ad-sidebar">Advertisement</div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        let sourceFile = null, canvasRef = document.createElement('canvas'), pages = 1;
        let setQuality = 0.4, setScale = 1.0;

        async function initTools(file) {
            if(!file) return;
            sourceFile = file;
            document.getElementById('drop-zone').style.display = 'none';
            document.getElementById('levels').style.display = 'grid';
            document.getElementById('preview-area').style.display = 'flex';
            document.getElementById('action-btn').style.display = 'block';

            const pdf = await pdfjsLib.getDocument({data: await file.arrayBuffer()}).promise;
            pages = pdf.numPages;
            const page = await pdf.getPage(1);
            const vp = page.getViewport({scale: 1.0});
            canvasRef.width = vp.width; canvasRef.height = vp.height;
            await page.render({canvasContext: canvasRef.getContext('2d'), viewport: vp}).promise;
            updatePreview();
        }

        function setLevel(q, s, el) {
            setQuality = q; setScale = s;
            document.querySelectorAll('.level-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            updatePreview();
        }

        function updatePreview() {
            document.getElementById('thumb-img').src = canvasRef.toDataURL('image/jpeg', setQuality);
        }

        async function runCompressionEngine() {
            document.getElementById('status-overlay').style.display = 'flex';
            const { jsPDF } = window.jspdf;
            const pdf = await pdfjsLib.getDocument({data: await sourceFile.arrayBuffer()}).promise;
            const doc = new jsPDF('p', 'mm', 'a4', true); // iLovePDF uses internal flate compression

            for (let i = 1; i <= pdf.numPages; i++) {
                document.getElementById('sub-status').innerText = `Optimizing page ${i} of ${pdf.numPages}...`;
                const page = await pdf.getPage(i);
                
                // Downsampling logic: Scale resolution based on selection
                const vp = page.getViewport({scale: setScale});
                const canv = document.createElement('canvas');
                canv.width = vp.width; canv.height = vp.height;
                await page.render({canvasContext: canv.getContext('2d'), viewport: vp}).promise;

                const imgData = canv.toDataURL('image/jpeg', setQuality);
                if (i > 1) doc.addPage();
                doc.addImage(imgData, 'JPEG', 0, 0, 210, (vp.height * 210) / vp.width, undefined, 'FAST');
            }

            let blob = doc.output('blob');
            
            // iLovePDF Safety: If the output is larger than input, use the input file
            if (blob.size > sourceFile.size) {
                blob = sourceFile;
            }

            window.finalFile = blob;
            document.getElementById('size-report').innerText = `Reduced from ${(sourceFile.size/1024).toFixed(0)}KB to ${(blob.size/1024).toFixed(0)}KB`;
            document.getElementById('status-overlay').style.display = 'none';
            document.getElementById('levels').style.display = 'none';
            document.getElementById('preview-area').style.display = 'none';
            document.getElementById('action-btn').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
        }

        function doDownload() {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(window.finalFile);
            a.download = "compressed_" + sourceFile.name;
            a.click();
        }
    </script>
</body>
</html>